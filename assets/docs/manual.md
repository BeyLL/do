# 建立远景与方向

# 度量

1. 技术债务评估

## 度量流程

### Path to Production

Path to Production，来源于精益，旨在通过可视化的方式来展示项目的上线流程，并优化过程中的瓶颈问题。它类似于我们使用 CI（持续集成）时的 Pipeline。传统的 Pipeline 的 gate 可以通过代码定义一些标准，由测试不能挂，测试覆盖率不能低于多少，打包不能失败等等。而这些 Pipeline 则是分别由开发人员、测试人员、运维人员、项目负责人等等来负责把控的。

对应的，在这个过程中：流程（Process）、人（People）、工具（Tooling）、产物（Artifacts） 都是我们的关注点：

 - Process，即上线需要多少流程。从提交代码开始，运行持续集成，部署到 Dev 环境等等。
 - People，即过程中需要哪些人来参与。如需要开发人员提交代码，需要测试人员进行 QA 环境部署，需要项目经理等高级领导进行上线审批等。
 - Tooling，即需要使用哪些工具来完成上线。如托管代码的 Git 服务器，运行构建的持续集成工具，提交上线申请的相关工具等等。
 - Artifacts，即过程中产出的产物。如生成的应用包，QA 生成的测试报告等等。

随后，我们从相关的流程中，梳理出每个部分（流程）的持续时间、痛点，来查找优化空间。

《[如何优化上线流程——Path to Production](https://www.phodal.com/blog/tech-lead-tools-path-to-production/)》

示例：

| 活动  | stage 1 |stage 1 |stage 1 |stage 1 |stage 1 |stage 1 |stage 1 |stage 1 |stage 1 |
|--------|--------|--------|--------|--------|--------|--------|--------|--------|--------|
| 流程 |  提交代码 | 运行 CI | 部署到  Dev 环境 | 运行 E2E 测试 | 手动测试 | 部署到 ST/UAT | 手动测试 | 上线申请 | 上线    |
| 人 |  Dev | Dev | Dev | Dev | Dev |  项目 QA | 业务 QA | 业务  QA |  PM | Dev | 
| 工具 | Git & GitHub | Jenkins |  Jenkins |  Jenkins |  - | Jenkins | - | 邮件  | - | 
| 制品 |  代码  | 持续集成结果 | -  |  测试报告  |  测试报告  |  - | 邮件结果  |  -| | 

## 度量工具

### 代码覆盖率

  - Java
    - [Cobertura](http://cobertura.github.io/cobertura/) 
    - [Jacoco](https://www.eclemma.org/jacoco/)
    - [Atlassian Clover](https://www.atlassian.com/software/clover)
  - JavaScript
    - [Istanbul](https://istanbul.js.org/)
    - [Jest](https://jestjs.io/)
  - Go

### 自动化性能测试

 - JMeter

### 代码质量分析工具

 - Java
   - CheckStyle
   - PMD/CPD
   - FindBugs
   - CodeNarc
 - JavaScript / TypeScript
   - Codelyzer
   - ESLint
 - 通用
    - Sonar

## 技术债务评估

# 准入条件

## 有意愿的组织

## 有意愿的个人

## 组织提供支持

# 探索：可行方案

## 可构建

### 遗留系统问题

## 可测试

### 遗留代码

### 重构还是放弃？

## 持续集成

## 多团队探索

如《架构师修炼之道》的『方法 15：分而治之』所建议的探索案例：

第一周的探索案例：

| 小组  | 探索任务  | 展示与说明  |
|-|-|-|
| 1 | 重构插件框架，判断原有代码库能否复用 | 展示重构的主要接口和类，说明计划是可行的 |
| 2 | 尝试 gRPC 服务 | 演示 Ruby 客户端与 Java 服务端的通讯 |
| 3 | 创建概念图并设计微服务分区 | 展示初步概念图。说明还有这么多工作要做 |

第二周的探索案例：

| 小组  | 探索任务  | 展示与说明  |
|-|-|-|
| 1 | 通过命令行调用原有插件 | 比预计的工作量多。说明存在哪些障碍，以及计划如何补救 |
| 2 | 寻找合适的数据库  |  比较三种数据库的优劣（快速浏览其代码）|
| 3 | 完善概念图，继续设计微服务分区 | 展示概念图和微服务的分区设计 | 

# 选择方案

如 《DevOps 实施手册：在多级 IT 企业中使用 DevOps》 所介绍的 DevOps 实施方案，几点要求：

 - 明确界定目标状态（业余目标及驱动力）
 - 理解现状（能力及成熟度模型）
 - 识别交付流水中效率低下领域的瓶颈问题（通过实施价值流程图）

结合之下我们有了初步的方案选择：

```mindmap
 - 建议衡量标准与关键绩效指标
    - 项目关键绩效指标
       - 速度
       - 成本
    - 关键绩效指标组合
    - 质量关键绩效指标
    - 交付流水线优化关键绩效指标
    - 文化关键绩效指标
 - 敏捷实施
    - 自动化部署
    - 进入类生产环境
    - 自动化测试
    - 监控与反馈
 - 集成的交付流水线
    - 实现端到端的可追溯性
    - 带有多重交付流水线的多级 IT
 - 持续集成
 - 持续交付
    - 自动化部署  
    - 数据库部署  
    - 部署内容、方式及环境
    - 持续集成到持续交付
    - 推送及拉取
    - 实施持续交付
    - 持续交付平台
 - 测试前移
    - 自动化测试与持续测试    
    - 测试服务及环境虚拟化    
    - 测试数据管理    
 - 运维参与前移
    - 转变运维角色    
    - IT 服务管理与 DevOps    
 - 持续监控及反馈
    - 提供监控与反馈    
    - 持续改进    
 - 发布管理
    - 发布流程管理    
    - 非持续发布周期的持续交付    
```

## 自动修复工具

 - Prettier 是一个代码风格统一工具。
 - Angular Lint。``ng lint --fix``

# 第一次 Showcase

# 实施方案

# 实施之后
 
## 回顾和总结 

## 输出

